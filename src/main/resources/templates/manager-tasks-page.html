<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Task Manager</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <style>
    .task-card {
      margin-bottom: 1rem;
      border: 1px solid #dee2e6;
    }
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
    }
    .completed {
      color: green;
    }
    .pending {
      color: orange;
    }
  </style>
</head>
<body>

<div th:if="${edited}" class="notification">
  <div class="alert alert-info alert-dismissible fade show">
    <strong> Task edited successfully! </strong>
    <span th:text="'Task: ' + ${editedtaskname} + ' was edited'" >  </span>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="close"></button>
  </div>

</div>

<div th:if="${deleted}" class="notification">
  <div class="alert alert-danger alert-dismissible fade show" role="alert">
    <strong>Task deleted successfully!</strong>
    <span th:if="${deleted}" th:text="'Task: ' + ${taskname} + ' was removed'"></span>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
</div>
<div th:if="${added}" class="notification">
  <div class="alert  alert-primary fade show" role="alert">
    <strong>Task Added successfully!</strong>
    <span th:if="${added}" th:text="'Task: ' + ${addedtaskname} + ' was added'"></span>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
</div>

<div class="container mt-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 th:text="${session.user != null ? 'Welcome manager : ' + session.user.username : 'GUEST'}"></h2>
    <a class="btn btn-primary" th:href="@{/managers/showadd}"> Add Task </a>
    <form method="POST" th:action="@{/logout}" action="#">
      <button class="btn btn-danger">Logout</button>
    </form>
  </div>

  <div class="card mb-3 task-card" th:each="task : ${tasks}">
    <div class="card-body">
      <h5 class="card-title" th:text="${task.taskName}"></h5>
      <p class="card-text" th:text="${task.taskDescription}"></p>
      <p class="card-text" th:text="'Created at ' + ${#temporals.format(task.creationDate,'dd MM yyyy')}"></p>
      <p class="card-text" th:text="'Priority: ' + ${task.taskPriority}"></p>
      <p class="card-text">
        Status:
        <span th:text="${task.done ? 'Completed' : 'Not Completed'}"
              th:classappend="${task.done ? 'text-success' : 'text-warning'}"></span>
      </p>

      <div class="d-flex gap-2">
        <a class="btn btn-primary btn-sm" th:href="@{/managers/showedit(taskid=${task.id})}">Edit</a>
        <a class="btn btn-danger btn-sm"
           th:href="@{/managers/deleteTask(taskid=${task.id})}">Delete</a>
      </div>
    </div>
  </div>
  <a th:href="@{/taskspage}"> <strong> Back to tasks page </strong>  </a>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>